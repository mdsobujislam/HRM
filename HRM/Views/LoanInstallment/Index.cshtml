@model IEnumerable<HRM.Models.LoanInstallment>
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container">
    <div class="row justify-content-center mb-3">
        <div class="col-md-4">
            <input type="number" id="searchEmpId" class="form-control" placeholder="Enter Employee ID" />
        </div>
        <div class="col-md-2">
            <button type="button" class="btn btn-primary w-100" onclick="searchEmployee()">Search</button>
        </div>
    </div>
</div>


<div class="row">
    <div class="col-md-12">
        <div class="card shadow">
            
            <div class="card-body">
                <form method="post" asp-action="Update">
                <div class="container my-3">
                    <div class="row align-items-center g-3">
                        <!-- loanid -->
                        <div class="col-md-2" style="display:none">
                                <input type="text" id="LoanId" class="form-control" name="LoanId" readonly value="@ViewBag.LoanId">
                        </div>
                            <!-- employee id -->
                            <div class="col-md-2" style="display:none">
                                <input type="text" id="EmployeeId" class="form-control" name="EmployeeId" readonly value="@ViewBag.EmployeeId">
                            </div>
                        <!-- Installment From -->
                        <div class="col-md-2">
                            <label for="installmentFrom" class="form-label">Installment From</label>
                                <input type="text" id="InstallmentFrom" class="form-control" name="InstallmentFrom" readonly value="@ViewBag.InstallmentFrom">
                        </div>

                        <!-- Installment To -->
                        <div class="col-md-2">
                            <label for="installmentTo" class="form-label">Installment To</label>
                                <input type="text" id="installmentTo" class="form-control" name="installmentTo" value="@ViewBag.InstallmentTo" AutoPostBack="True">
                        </div>

                            <!-- EMI Amount -->
                        <div class="col-md-2">
                            <label for="netAmount" class="form-label">EMI</label>
                                <input type="text" id="netAmount" class="form-control" name="netAmount" readonly value="@ViewBag.NetAmount">
                        </div>
                            <!-- Totall Amount -->
                            <div class="col-md-2">
                                <label for="TotalAmount" class="form-label">Totall Amount</label>
                                <input type="text" id="TotalAmount" class="form-control" name="TotalAmount" readonly value="@ViewBag.TotalAmount">
                            </div>

                        <!-- Date of Payment -->
                        <div class="col-md-3">
                            <label for="dateOfPayment" class="form-label">Date of Payment</label>
                            <div class="input-group">
                                    <input type="date" id="dateOfPayment" class="form-control" name="dateOfPayment" placeholder="dd/MM/yyyy">
                            </div>
                        </div>

                        <!-- Pay Button -->
                        <div class="col-md-2 d-grid">
                            <button type="submit" class="btn btn-primary">Pay</button>
                        </div>
                    </div>
                    <hr class="mt-3" />
                </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card shadow">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Loan Installment List</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table  datanew">
                        <thead class="table-primary">
                            <tr>
                                <th>SL No.</th>
                                <th>Loan ID</th>
                                <th>Inst No	</th>
                                <th>Inst Date</th>
                                <th>Inst Amount</th>
                                <th>Status</th>
                                <th>Payment Date</th>
                                <th>Installment Details</th>
                                <th>Salary Month</th>
                                <th>Salary Year</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                int index = 0;
                                foreach (var item in Model)
                                {
                                    index++;
                                    <tr>
                                        <td>@index</td>
                                        <td>@item.LoanId</td>
                                        <td>@item.Installment_No</td>
                                        <td>@item.DateOfInstallment</td>
                                        <td>@item.Installment_Amount</td>
                                        <td>@item.InstallmentStatus</td>
                                        <td>@item.PaymentDate</td>
                                        <td>@item.InstallmentDetails</td>
                                        <td>@item.SalaryMonth</td>
                                        <td>@item.SalaryYear</td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function searchEmployee() {
        var empId = document.getElementById("searchEmpId").value;
        if (empId) {
            // Redirect to Index action with empId
            window.location.href = '/LoanInstallment/Index?empId=' + empId;
        } else {
            alert("Please enter an Employee ID");
        }
    }
</script>

<script>
    function calculateTotal() {
        var from = parseInt(document.getElementById("InstallmentFrom").value) || 0;
        var to = parseInt(document.getElementById("installmentTo").value) || 0;
        var net = parseFloat(document.getElementById("netAmount").value) || 0;

        if (from > 0 && to > 0 && net > 0) {
            var total = ((to - from) + 1) * net;
            document.getElementById("TotalAmount").value = total.toFixed(2);
        }
    }

    // Recalculate when InstallmentTo changes
    document.getElementById("installmentTo").addEventListener("input", calculateTotal);
</script>
